"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const OverviewPage_1 = require("../../export/pages/OverviewPage");
const decorators_1 = require("../../../common/decoration/decorators");
const manifest_1 = require("../../export/manifest");
const controls_1 = require("../../export/controls");
const Card_1 = require("../../../../specification/v2/controls/Card");
function transferSettingsOfObject(configPart, manifest, jsonSchema, pathHierarchy) {
    if (!jsonSchema) {
        return;
    }
    for (const propertyKey in jsonSchema) {
        const syncRule = decorators_1.getReflectMetadata(configPart, propertyKey);
        if (syncRule && syncRule.manifest) {
            const path = syncRule.manifest.path([...pathHierarchy, propertyKey]);
            const manifestSection = manifest_1.getManifestSectionByPathV2(manifest, path);
            if (Object.prototype.hasOwnProperty.call(manifestSection, propertyKey)) {
                if (pathHierarchy.length !== 0) {
                    if (propertyKey === 'settings') {
                        switch (manifestSection['template']) {
                            case 'sap.ovp.cards.charts.analytical':
                                configPart[pathHierarchy[0]][Card_1.CardSettingsType.analyticalCardSettings] =
                                    manifestSection[propertyKey];
                                break;
                            case 'sap.ovp.cards.v4.charts.analytical':
                                configPart[pathHierarchy[0]][Card_1.CardSettingsType.analyticalCardSettingsv4] =
                                    manifestSection[propertyKey];
                                break;
                            case 'sap.ovp.cards.list':
                            case 'sap.ovp.cards.v4.list':
                                configPart[pathHierarchy[0]][Card_1.CardSettingsType.listCardSettings] =
                                    manifestSection[propertyKey];
                                break;
                            case 'sap.ovp.cards.stack':
                                configPart[pathHierarchy[0]][Card_1.CardSettingsType.stackCardSettings] =
                                    manifestSection[propertyKey];
                                break;
                            case 'sap.ovp.cards.linklist':
                                configPart[pathHierarchy[0]][Card_1.CardSettingsType.linkListCardSettings] =
                                    manifestSection[propertyKey];
                                break;
                            case 'sap.ovp.cards.table':
                            case 'sap.ovp.cards.v4.table':
                                configPart[pathHierarchy[0]][Card_1.CardSettingsType.tableCardSettings] =
                                    manifestSection[propertyKey];
                                break;
                            default:
                                configPart[pathHierarchy[0]]['settings'] = manifestSection[propertyKey];
                                break;
                        }
                    }
                    else {
                        configPart[pathHierarchy[0]][propertyKey] = manifestSection[propertyKey];
                    }
                }
                else {
                    const importHandler = syncRule.manifest.import;
                    if (importHandler !== false) {
                        if (importHandler && typeof importHandler === 'function') {
                            const value = importHandler(manifestSection[propertyKey]);
                            if (value !== undefined) {
                                configPart[propertyKey] = value;
                            }
                        }
                        else {
                            configPart[propertyKey] = manifestSection[propertyKey];
                        }
                    }
                }
            }
        }
    }
}
function addSettings(OverviewPageConfig, manifest, jsonSchema) {
    transferSettingsOfObject(OverviewPageConfig, manifest, jsonSchema['properties'], []);
    OverviewPageConfig.cards = {};
    Object.keys(manifest['sap.ovp']['cards']).forEach((newKey) => {
        const cardType = manifest['sap.ovp']['cards'][newKey].template;
        switch (cardType) {
            case Card_1.CardTemplateType.list:
            case Card_1.CardTemplateType.listv4:
                OverviewPageConfig.cards[newKey] = new controls_1.ListCard();
                OverviewPageConfig.cards = Object.assign(new controls_1.ListCard(), OverviewPageConfig.cards);
                break;
            case Card_1.CardTemplateType.stack:
                OverviewPageConfig.cards[newKey] = new controls_1.StackCard();
                OverviewPageConfig.cards = Object.assign(new controls_1.StackCard(), OverviewPageConfig.cards);
                break;
            case Card_1.CardTemplateType.linklist:
                OverviewPageConfig.cards[newKey] = new controls_1.LinklistCard();
                OverviewPageConfig.cards = Object.assign(new controls_1.LinklistCard(), OverviewPageConfig.cards);
                break;
            case Card_1.CardTemplateType.table:
            case Card_1.CardTemplateType.tablev4:
                OverviewPageConfig.cards[newKey] = new controls_1.TableCard();
                OverviewPageConfig.cards = Object.assign(new controls_1.TableCard(), OverviewPageConfig.cards);
                break;
            case Card_1.CardTemplateType.analytical:
            case Card_1.CardTemplateType.analyticalv4:
                OverviewPageConfig.cards[newKey] = new controls_1.AnalyticalCard();
                OverviewPageConfig.cards = Object.assign(new controls_1.AnalyticalCard(), OverviewPageConfig.cards);
                break;
            default:
                OverviewPageConfig.cards[newKey] = new controls_1.CustomCard();
                OverviewPageConfig.cards = Object.assign(new controls_1.CustomCard(), OverviewPageConfig.cards);
                break;
        }
        transferSettingsOfObject(OverviewPageConfig.cards, manifest, manifest['sap.ovp']['cards'][newKey], [newKey]);
    });
}
function createOverviewPageConfig(manifest, jsonSchema) {
    const config = new OverviewPage_1.OverviewPage();
    addSettings(config, manifest, jsonSchema);
    return config;
}
exports.createOverviewPageConfig = createOverviewPageConfig;
//# sourceMappingURL=overviewPage.js.map
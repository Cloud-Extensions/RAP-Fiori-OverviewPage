"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const utils_1 = require("./utils");
const import_1 = require("../import");
const v2_1 = require("../../../specification/v2");
/**
 * Generates an app specific schema out of the generic schema.
 * Generic types are replaced by information from the app specific annotations.
 *
 * @param genericSchema - generic JSON schema of a list report
 * @param entityTypeName - the base entity type of the given page
 * @param entityTypes - list of all entity types
 * @param page - page as defined in the manifest
 * @param manifest - manifest.json of the app
 */
function generateAnalyticalListReportSchemaV2(genericSchema, entityTypeName, entityTypes, manifest, fragments) {
    const appSchema = JSON.parse(JSON.stringify(genericSchema));
    appSchema['properties']['table']['$ref'] = '#/definitions/AnalyticalTableALP<LineItems>';
    const analyticalTableDefinition = JSON.parse(JSON.stringify(appSchema['definitions']['AnalyticalTableALP<GenericColumns>']));
    analyticalTableDefinition['properties']['columns'] = {
        $ref: '#/definitions/LineItems'
    };
    appSchema['definitions']['AnalyticalTableALP<LineItems>'] = analyticalTableDefinition;
    delete appSchema['definitions']['AnalyticalTableALP<GenericColumns>'];
    delete appSchema['definitions']['GenericColumns'];
    // Remove Custom Column non existing extensions - TreeTableColumnsExtension does not exist in ALP
    utils_1.removeElementsFromEnum(appSchema['definitions']['TableColumnExtensionTypeV2']['enum'], [
        v2_1.TableColumnExtensionTypeV2.TreeTableColumnsExtension
    ]);
    const entityType = entityTypes.find((et) => et.name === entityTypeName);
    const lineItemAnnotation = entityType.annotations && entityType.annotations.UI && entityType.annotations.UI.LineItem;
    utils_1.addLineItemsType(appSchema, lineItemAnnotation, entityType);
    const pageKeys = [];
    const v2Page = import_1.findAnalyticalListPage(manifest['sap.ui.generic.app'].pages, pageKeys);
    utils_1.addListReportColumnExtensions(appSchema, entityType, v2Page, manifest, fragments);
    utils_1.checkGenerateRules(appSchema);
    return appSchema;
}
exports.generateAnalyticalListReportSchemaV2 = generateAnalyticalListReportSchemaV2;
//# sourceMappingURL=analyticalListReport.js.map
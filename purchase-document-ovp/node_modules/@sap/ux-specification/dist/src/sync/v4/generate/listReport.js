"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const i18next_1 = __importDefault(require("i18next"));
const extensionLogger_1 = require("../../../extensionLogger");
const utils_1 = require("../utils/utils");
/**
 * Generates an app specific schema for the FE V4 Listreport from the generic schema.
 * Generic types are replaced by information from the app specific annotations.
 *
 * @param {object} genericSchema - generic JSON schema of a list report
 * @param {string} entityTypeName - the base entity type of the given page
 * @param {ConverterOutput} oDataServiceAVT - complete service information, as returned by Annotation Vocabularies Tool
 * @returns {object} application-specific schema of the list report
 */
function generateListReportSchemaV4(genericSchema, entityTypeName, oDataServiceAVT, logger) {
    const appSchema = JSON.parse(JSON.stringify(genericSchema));
    const entityType = oDataServiceAVT.entityTypes.find((et) => et.name === entityTypeName);
    if (!entityType) {
        extensionLogger_1.log(logger, {
            severity: "error" /* Error */,
            message: i18next_1.default.t('NOENTITYPE', { entityType: entityTypeName }),
            location: {
                path: 'webapp/localService/metadata.xml'
            }
        });
    }
    else {
        const lineItemAnnotation = entityType && entityType.annotations && entityType.annotations.UI && entityType.annotations.UI.LineItem;
        utils_1.addLineItemsType(appSchema, lineItemAnnotation, entityType);
        //Switch from generic column to specific definition
        appSchema['definitions']['Table'].properties['columns'].$ref = '#/definitions/LineItems';
        delete appSchema['definitions']['GenericColumns'];
    }
    return appSchema;
}
exports.generateListReportSchemaV4 = generateListReportSchemaV4;
//# sourceMappingURL=listReport.js.map